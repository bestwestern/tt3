function genberegn(){vistsol.udregncon(!0),vistsol.udregncon(!1),$("#content").html(lavtablerowhtml(vistsol))}function randomtid(){var n=$("#antalrandomtid").val();$("#randomresbutton").remove(),vistsol.randomtidtildel(n)}function randomres(){var n=$("#antalrandomtid").val();vistsol.randontildelres(n)}function tildeltid0(){for(var r=!1,n,t,u,i=0;i<events.length;i++)if(n=events[i],!n.preasigntime)for(t=0;t<n.duration;t++)u=timer[vistsol.tidmangeltildelinger[n.eventtidmangler[t].index]],u||(vistsol.tildeltidtilevent(n.eventtidmangler[t].index,0),r=!0);r&&($("#content").html(lavtablerowhtml(vistsol)),vistsol.udregncon(!0),vistsol.udregncon(!1))}function lavxmlserver(){var t;tildeltid0();var n=[];n.push(events),t=JSON.stringify(n,["id","preasigntime","duration","eventresmangler"]),$.ajax({type:"POST",url:"Default.aspx/savesolution",data:"{sol:"+t+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n.d}}).always(function(){})}function lavxml(n){var a,v,o,t,it,u,y,w,b,p,k,d,r,s,g,h,i,f,e,c;tildeltid0();var nt=new XMLSerializer,rt=xmlDoc.getElementsByTagName("Instances")[0],tt=xmlDoc.getElementsByTagName("SolutionGroups")[0],l=xmlDoc.createElement("SolutionGroup");for(l.setAttribute("Id","Runessol"+Math.random()*1e3),a=xmlDoc.createElement("Solution"),a.setAttribute("Reference",xmlinstans),v=addnode("Events",a),o=0;o<antalevents;o++)for(t=events[o],o==50&&(it=4),u=0;u<t.duration;u++)if(t.preasigntime){if(u==0)for(r=addnode("Event",v),r.setAttribute("Reference",t.id),addnode("Duration",r,t.duration.toString()),s=addnode("Time",r),s.setAttribute("Reference",timer[t.preasigntime.index].id),h=addnode("Resources",r),i=0;i<t.eventresmangler.length;i++)f=vistsol.resmangeltildelinger[t.eventresmangler[i].index],f!=undefined&&(e=addnode("Resource",h),e.setAttribute("Reference",resourcer[f].id),addnode("Role",e,t.eventresmangler[i].role))}else{if(y=!0,u>0&&(w=vistsol.tidmangeltildelinger[t.eventtidmangler[u].index],b=vistsol.tidmangeltildelinger[t.eventtidmangler[u-1].index],w==b+1)){for(p=!0,i=u;i<t.eventresmangler.length;i+=t.duration)k=vistsol.resmangeltildelinger[t.eventresmangler[i].index],d=vistsol.resmangeltildelinger[t.eventresmangler[i-1].index],k!=d&&(p=!1);p&&(r.childNodes[0].childNodes[0].nodeValue=Number(r.childNodes[0].childNodes[0].nodeValue)+1,y=!1)}if(y)for(r=addnode("Event",v),r.setAttribute("Reference",t.id),addnode("Duration",r,"1"),s=addnode("Time",r),g=vistsol.tidmangeltildelinger[t.eventtidmangler[u].index],s.setAttribute("Reference",timer[g].id),h=addnode("Resources",r),i=u;i<t.eventresmangler.length;i+=t.duration)f=vistsol.resmangeltildelinger[t.eventresmangler[i].index],f!=undefined&&(e=addnode("Resource",h),e.setAttribute("Reference",resourcer[f].id),addnode("Role",e,t.eventresmangler[i].role))}c=xmlDoc.createElement("MetaData"),addnode("Contributor",c,"run@sdu.dk"),addnode("Date",c,(new Date).toDateString()),addnode("Description",c,"Speciale"),l.appendChild(c),l.appendChild(a),tt.appendChild(l),n?$.ajax({type:"POST",url:"Default.aspx/savesolution",data:"{sol:"+JSON.stringify(xmlDoc)+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n.d}}).always(function(){}):window.open("data:text/xml,"+nt.serializeToString(xmlDoc))}function addnode(n,t,i){var r=xmlDoc.createElement(n),u;return i&&(u=xmlDoc.createTextNode("ch"),u.nodeValue=i,r.appendChild(u)),t.appendChild(r),r}function choicemade(n,t,i){var f=i.getAttribute("data-eventindex"),s=i.getAttribute("data-durationindex"),h=i.getAttribute("data-tidmangelindex"),r,e,u,o;if(n)r=Number(i.options[i.selectedIndex].value),isNaN(r)&&(r=-1),vistsol.tildeltidtilevent(t,r);else{if(r=Number(i.options[i.selectedIndex].value),e=vistsol.resmangeltildelinger[t],u=h<0?h*-1-1:vistsol.tidmangeltildelinger[h],u!=null)if(h<0)for(o=0;o<events[f].duration;o++)e!==undefined&&vistsol.fratagresourcetileventtiltid(e,s,u+o,f),isNaN(r)||vistsol.tildelresourcetileventtiltid(r,s,u+o,f);else e!==undefined&&vistsol.fratagresourcetileventtiltid(e,s,u,f),isNaN(r)||vistsol.tildelresourcetileventtiltid(r,s,u,f);vistsol.resmangeltildelinger[t]=isNaN(r)?null:r}$("#content").html(lavtablerowhtml(vistsol)),vistsol.udregncon(!0),vistsol.udregncon(!1)}function assert(n,t){var i=document.getElementById("results"),r;i||(i=document.createElement("ul"),document.getElementsByTagName("body")[0].appendChild(i),i.setAttribute("id","results")),r=document.createElement("li"),r.className=n?"pass":"fail",r.appendChild(document.createTextNode(t)),i.appendChild(r)}function lavtablerowhtml(n){for(var s="<table><thead><tr><td>Event<\/td><td>Time<\/td><\/tr><\/thead>",k={},lt=events.length,d=" <option> Not chosen<\/option> ",t,g,i,c,u,ft,f,a,v,nt,tt,e,et,y,p,ht,l,h,ct,rt,w,b,ut,r=0,o=timer.length;r<o;r++)d+="<option value='"+timer[r].index+"'>"+timer[r].name+"<\/option>";for(d+="<\/select>",r=0;r<lt;r++)for(t=events[r],g=t.eventresmangler.length,i=0;i<t.duration;i++){if(c=t.name,u="",t.preasigntime){if(i==0){for(t.duration>1&&(c+=" ("+t.duration+")"),f=0,o=t.eventresourcer.length;f<o;f++)u+=t.eventresourcer[f].name+", ";s+=u.length>0?"<tr title='"+u.substr(0,u.length-2)+"'><td>":"<tr><td>",ft=timer[t.preasigntime.index+i],s+=c+"<\/td><td>Time:"+ft.name+"<\/td>"}}else{for(t.duration>1&&(c+=" ("+(i+1)+"/"+t.duration+")"),f=0,o=t.eventresourcer.length;f<o;f++)u+=t.eventresourcer[f].name+", ";s+=u.length>0?"<tr title='"+u.substr(0,u.length-2)+"'><td>":"<tr><td>",a=d,v=n.tidmangeltildelinger[t.eventtidmangler[i].index],v>-2&&(a=a.replace("'"+v+"'","'"+v+"' selected")),s+=c+"<\/td><td>Time:<select  data-eventindex="+t.index+"  data-durationindex="+i+"  data-tidmangelindex="+t.eventtidmangler[i].index+"   onchange='choicemade(true,"+t.eventtidmangler[i].index+",this)'>"+a+"<\/td>"}for(nt=i,tt=t.duration,t.preasigntime&&(i==0?tt=1:nt=g),e=nt;e<g;e=e+tt){if(et=t.eventresmangler[e].role,y=t.eventresmangler[e].resourcetype.id,k[y]===undefined){var ot=[],it="<option>Not chosen<\/option>",st=t.eventresmangler[e].resourcetype.resourcegroups;for(p=0,ht=st.length;p<ht;p++)for(l=st[p].resourcer,h=0,ct=l.length;h<ct;h++)ot.indexOf(l[h].index)==-1&&(rt=l[h].index,ot.push(rt),it+="<option value='"+rt+"'>"+l[h].name+"<\/option>");it+="<\/select>",k[y]=it}w=k[y],b=n.resmangeltildelinger[t.eventresmangler[e].index],b>-2&&(w=w.replace("'"+b+"'","'"+b+"' selected")),ut=t.eventtidmangler[i]!=undefined?t.eventtidmangler[i].index:-(t.preasigntime.index+i)-1,s+="<td> "+et+":<select data-eventindex="+t.index+"  data-durationindex="+i+"  data-tidmangelindex="+ut+" onchange='choicemade(false,"+t.eventresmangler[e].index+",this)'>>"+w+"<\/td>"}}return s+"<\/table>"}var timer,vistsol,tidsgrupper,resourcetyper,resourcegrupper,resourcer,eventgrupper,events,antalevents,antalresourcer,antaltider,hardconstraints,softconstraints,resmangler,tidmangler,counter=0,xmlDoc,xmlinstans;window.onload=function(){"use strict";var n,r,t,i;if([][3]=[5],n=["DenmarkSmallSchool","test","NetherlandsKottenpark2009","ArtificialORLibrary-hdtt6","ArtificialSudoku4x4","AustraliaBGHS98","AustraliaSAHS96","BrazilInstance1","BrazilInstance4","DenmarkHasserisGymnasium2012","EnglandStPaul","GreeceHighSchool1","FinlandCollege","FinlandSecondarySchool","NetherlandsGEPRO","SouthAfricaLewitt2009","SpainSchool","ItalyInstance1"],r=0,r)for(t=0;t<n.length;t++)events=[],instans.readxml("XML/"+n[t]+".xml");i=n[2],instans.readxml("XML/"+i+".xml"),vistsol=new solution.Sol,$("#filnavn").text(n.indexOf(i)+":"+i),$("#content").html(lavtablerowhtml(vistsol))}