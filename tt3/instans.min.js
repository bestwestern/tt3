var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function p(n){var t,tt,ut,gt,d,ft,ht,p,et,g,v,kt,y,ct,bt,ni,k,lt,at,h,rt,pt;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[];var k,lt,nt=[],dt=[],ti=n.Instances.Instance.Times,ot=ti.TimeGroups;if("Week"in ot)if(t=ot.Week,t instanceof Array)for(h in t)tidsgrupper.push(new u(t[h].Id,t[h].Name)),nt.push(t[h].Id);else tidsgrupper.push(new u(t.Id,t.Name)),nt.push(t.Id);if("Day"in ot)if(t=ot.Day,t instanceof Array)for(h in t)tidsgrupper.push(new f(t[h].Id,t[h].Name)),nt.push(t[h].Id);else tidsgrupper.push(new f(t.Id,t.Name)),nt.push(t.Id);if("TimeGroup"in ot)if(t=ot.TimeGroup,t instanceof Array)for(h in t)tidsgrupper.push(new i(t[h].Id,t[h].Name)),nt.push(t[h].Id);else tidsgrupper.push(new i(t.Id,t.Name)),nt.push(t.Id);ot=null,t=ti.Time;for(h in t){if(tt=t[h],ut=new c(tt.Id,tt.Name),tt.Week&&(d=tidsgrupper[nt.indexOf(tt.Week.Reference)],ut.timegroups.push(d),d.timer.push(ut)),tt.Day&&(d=tidsgrupper[nt.indexOf(tt.Day.Reference)],ut.timegroups.push(d),d.timer.push(ut)),tt.TimeGroups){gt=tt.TimeGroups.TimeGroup;for(h in gt)k=gt[h],k.Reference&&(k=k.Reference),d=tidsgrupper[nt.indexOf(k)],ut.timegroups.push(d),d.timer.push(ut)}timer.push(ut)}var vt=n.Instances.Instance.Resources,st=[],wt=[];if(vt.ResourceTypes)if(t=vt.ResourceTypes.ResourceType,t instanceof Array)for(h in t)resourcetyper.push(new o(t[h].Name,t[h].Id)),st.push(t[h].Id);else resourcetyper.push(new o(t.Name,t.Id)),st.push(t.Id);if(vt.ResourceGroups)if(t=vt.ResourceGroups.ResourceGroup,t instanceof Array)for(h in t){var it=t[h],yt=resourcetyper[st.indexOf(it.ResourceType.Reference)],p=new s(it.Id,it.Name,yt);resourcegrupper.push(p),yt.resourcegroups.push(p),wt.push(it.Id)}else{var it=t,yt=resourcetyper[st.indexOf(it.ResourceType.Reference)],p=new s(it.Id,it.Name,yt);resourcegrupper.push(p),yt.resourcegroups.push(p),wt.push(it.Id)}t=vt.Resource;for(h in t){ft=t[h],ht=new l(ft.Name,ft.Id,resourcetyper[st.indexOf(ft.ResourceType.Reference)]);for(bt in ft.ResourceGroups.ResourceGroup)k=ft.ResourceGroups.ResourceGroup[bt],(p=resourcegrupper[wt.indexOf(k)])?p===null?alert("fejl ved "+ft.Id):(p.resourcer.push(ht),ht.resourcegroups.push(p)):(p=resourcegrupper[wt.indexOf(k.Reference)],p===null?alert("fejl ved "+ft.Id):(p.resourcer.push(ht),ht.resourcegroups.push(p)));resourcer.push(ht),dt.push(ht.id)}if(et=n.Instances.Instance.Events,g=[],et.EventGroups){if(v=et.EventGroups.Course,v)if(v instanceof Array)for(h in v)eventgrupper.push(new e(v[h].Name,v[h].Id)),g.push(v[h].Id);else eventgrupper.push(new e(v.Name,v.Id)),g.push(v.Id);if(v=et.EventGroups.EventGroup,v)if(v instanceof Array)for(h in v)eventgrupper.push(new r(v[h].Name,v[h].Id)),g.push(v[h].Id);else eventgrupper.push(new r(v.Name,v.Id)),g.push(v.Id)}et=et.Event,kt=[];for(h in et){y=et[h],ct=new a(y.Id,y.Name,y.Duration);for(bt in y.Course)ni=y.Course[bt],g.indexOf(ni)>-1?ct.eventeventgrupper.push(eventgrupper[g.indexOf(ni)]):alert("fejl ved indlæsning af event "+y.Name);if(y.EventGroups){v=y.EventGroups,v.EventGroup&&(v=v.EventGroup);for(h in v)k=v[h],lt=g.indexOf(k.Reference),lt==-1&&(lt=g.indexOf(k)),lt==-1?alert("fejl3 ved indlæsning af evengroups for event "+y.Name):ct.eventeventgrupper.push(eventgrupper[lt])}if("Resources"in y&&y.Resources.Resource)if(y.Resources.Resource instanceof Array)for(rt=0,pt=y.Resources.Resource.length;rt<pt;rt++)w(y.Resources.Resource[rt],dt,ct,st);else w(y.Resources.Resource,dt,ct,st);events.push(ct),kt.push(ct.id)}at=n.Instances.Instance.Constraints;for(h in at)if(at[h]instanceof Array)for(rt=0,pt=at[h].length;rt<pt;rt++)b(at[h][rt],h,g,kt);else b(at[h],h,g,kt)}function g(n){function f(n){function u(n,t){i[n]?(i[n].constructor!=Array&&(i[n]=[i[n]]),i[n][i[n].length]=t):i[n]=t}for(var i={},t,r=0;t=n.attributes[r];r++)u(t.name,t.value);for(r=0;t=n.childNodes[r];r++)t.nodeType==1&&(t.childNodes.length==1&&t.firstChild.nodeType==3?u(t.nodeName,t.firstChild.nodeValue):u(t.nodeName,f(t)));return i}var i,r,u,t;for(i=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.open("GET",n,!1),i.send(),r=i.responseXML,t=0;t<r.childNodes.length;t++)if(r.childNodes[t].baseName==="HighSchoolTimetableArchive"){u=f(r.childNodes[t]),p(u);break}}function w(n,t,i,r){var u,f;"Reference"in n?(u=resourcer[t.indexOf(n.Reference)],u?i.eventresourcer.push(u):alert("fejl5 ved indlæsning af resource for ")):"Role"in n&&"ResourceType"in n?(f=resourcetyper[r.indexOf(n.ResourceType.Reference)],f?i.eventmangler.push(new v(n.Role,f,n.Workload)):alert("fejlx v res event")):alert("fejl v res event")}function b(n,t,i,r){var e=n.Name,o=n.Id,s=n.Weight,a=n.Required=="true",c=n.CostFunction,v=n.Role,u,f,l;switch(t){case"AssignResourceConstraint":u=new y(o,e,s,c,v);break;case"AssignTimeConstraint":u=new h(o,e,s,c);break;case"PreferTimesConstraint":u=new k(o,e,s,c);break;case"SpreadEventsConstraint":u=new d(o,e,s,c)}if(u){if(n.AppliesTo.Events)if(f=n.AppliesTo,f.Events.Event instanceof Array)for(l in f.Events.Event)u.appliestogre.push(eventgrupper[r.indexOf(f.Events.Event[l].Reference)]);else u.appliestoev.push(events[r.indexOf(f.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(f=n.AppliesTo,f.EventGroups.EventGroup instanceof Array)for(l in f.EventGroups.EventGroup)u.appliestogre.push(eventgrupper[i.indexOf(f.EventGroups.EventGroup[l].Reference)]);else u.appliestogre.push(eventgrupper[i.indexOf(f.EventGroups.EventGroup.Reference)]);a?hardconstraints.push(u):softconstraints.push(u)}}var y=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.role=u,this.appliestogre=[],this.appliestoev=[]}return n}(),h,c,i,u,f,r,e,o,s,l,a,v;n.AssignResourceConstraint=y,h=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=[]}return n}(),n.AssignTimeConstraint=h;var k=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=[]}return n}(),d=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=null}return n}(),t=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}();n.Entity=t,c=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[]}return __extends(t,n),t}(t),n.Time=c,i=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(t),n.TimeGroup=i,u=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Week=u,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Day=f,r=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(t),n.EventGroup=r,e=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(r),n.Course=e,o=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(t),n.ResourceType=o,s=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(t),n.ResourceGroup=s,l=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[]}return __extends(t,n),t}(t),n.Resource=l,a=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.time=u,this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventmangler=[]}return n}(),n.AEvent=a,v=function(){function n(n,t,i){this.role=n,this.resourcetype=t,this.workload=i,(n===null||t===null)&&alert("fejl ved indlæsningh af mangel "+n+","+t.name)}return n}(),n.Mangel=v,n.readinstance=p,n.readxml=g})(instans||(instans={}))