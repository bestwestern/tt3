var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function p(n){var t,tt,rt,kt,k,ut,ot,d,ft,g,v,wt,y,st,pt,gt,p,ht,ct,o,it,vt;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[];var p,ht,nt=[],bt=[],ni=n.Instances.Instance.Times,et=ni.TimeGroups;if("Week"in et)if(t=et.Week,t instanceof Array)for(o in t)tidsgrupper.push(new u(t[o].Id,t[o].Name)),nt.push(t[o].Id);else tidsgrupper.push(new u(t.Id,t.Name)),nt.push(t.Id);if("Day"in et)if(t=et.Day,t instanceof Array)for(o in t)tidsgrupper.push(new f(t[o].Id,t[o].Name)),nt.push(t[o].Id);else tidsgrupper.push(new f(t.Id,t.Name)),nt.push(t.Id);if("TimeGroup"in et)if(t=et.TimeGroup,t instanceof Array)for(o in t)tidsgrupper.push(new i(t[o].Id,t[o].Name)),nt.push(t[o].Id);else tidsgrupper.push(new i(t.Id,t.Name)),nt.push(t.Id);et=null,t=ni.Time;for(o in t){if(tt=t[o],rt=new s(tt.Id,tt.Name),tt.Week&&(k=tidsgrupper[nt.indexOf(tt.Week.Reference)],rt.timegroups.push(k),k.timer.push(rt)),tt.Day&&(k=tidsgrupper[nt.indexOf(tt.Day.Reference)],rt.timegroups.push(k),k.timer.push(rt)),tt.TimeGroups){kt=tt.TimeGroups.TimeGroup;for(o in kt)p=kt[o],p.Reference&&(p=p.Reference),k=tidsgrupper[nt.indexOf(p)],rt.timegroups.push(k),k.timer.push(rt)}timer.push(rt)}var lt=n.Instances.Instance.Resources,at=[],dt=[];if(lt.ResourceTypes){t=lt.ResourceTypes.ResourceType;for(o in t)resourcetyper.push(new h(t[o].Name,t[o].Id)),at.push(t[o].Id)}if(lt.ResourceGroups){t=lt.ResourceGroups.ResourceGroup;for(o in t){var yt=t[o],ti=resourcetyper[at.indexOf(yt.ResourceType.Reference)],d=new c(yt.Id,yt.Name,ti);resourcegrupper.push(d),ti.resourcegroups.push(d),dt.push(yt.Id)}}t=lt.Resource;for(o in t){ut=t[o],ot=new l(ut.Name,ut.Id,resourcetyper[at.indexOf(ut.ResourceType.Reference)]);for(pt in ut.ResourceGroups.ResourceGroup)p=ut.ResourceGroups.ResourceGroup[pt],(d=resourcegrupper[dt.indexOf(p)])?d===null?alert("fejl ved "+ut.Id):(d.resourcer.push(ot),ot.resourcegroups.push(d)):(d=resourcegrupper[dt.indexOf(p.Reference)],d===null?alert("fejl ved "+ut.Id):(d.resourcer.push(ot),ot.resourcegroups.push(d)));resourcer.push(ot),bt.push(ot.id)}if(ft=n.Instances.Instance.Events,g=[],ft.EventGroups){if(v=ft.EventGroups.Course,v)if(v instanceof Array)for(o in v)eventgrupper.push(new e(v[o].Name,v[o].Id)),g.push(v[o].Id);else eventgrupper.push(new e(v.Name,v.Id)),g.push(v.Id);if(v=ft.EventGroups.EventGroup,v)if(v instanceof Array)for(o in v)eventgrupper.push(new r(v[o].Name,v[o].Id)),g.push(v[o].Id);else eventgrupper.push(new r(v.Name,v.Id)),g.push(v.Id)}ft=ft.Event,wt=[];for(o in ft){y=ft[o],st=new a(y.Id,y.Name,y.Duration);for(pt in y.Course)gt=y.Course[pt],g.indexOf(gt)>-1?st.eventeventgrupper.push(eventgrupper[g.indexOf(gt)]):alert("fejl ved indlæsning af event "+y.Name);if(y.EventGroups){v=y.EventGroups,v.EventGroup&&(v=v.EventGroup);for(o in v)p=v[o],ht=g.indexOf(p.Reference),ht==-1&&(ht=g.indexOf(p)),ht==-1?alert("fejl3 ved indlæsning af evengroups for event "+y.Name):st.eventeventgrupper.push(eventgrupper[ht])}if("Resources"in y&&y.Resources.Resource)if(y.Resources.Resource instanceof Array)for(it=0,vt=y.Resources.Resource.length;it<vt;it++)w(y.Resources.Resource[it],bt,st,at);else w(y.Resources.Resource,bt,st,at);events.push(st),wt.push(st.id)}ct=n.Instances.Instance.Constraints;for(o in ct)if(ct[o]instanceof Array)for(it=0,vt=ct[o].length;it<vt;it++)b(ct[o][it],o,g,wt);else b(ct[o],o,g,wt)}function g(n){function f(n){function u(n,t){i[n]?(i[n].constructor!=Array&&(i[n]=[i[n]]),i[n][i[n].length]=t):i[n]=t}for(var i={},t,r=0;t=n.attributes[r];r++)u(t.name,t.value);for(r=0;t=n.childNodes[r];r++)t.nodeType==1&&(t.childNodes.length==1&&t.firstChild.nodeType==3?u(t.nodeName,t.firstChild.nodeValue):u(t.nodeName,f(t)));return i}var i,r,u,t;for(i=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.open("GET",n,!1),i.send(),r=i.responseXML,t=0;t<r.childNodes.length;t++)if(r.childNodes[t].baseName==="HighSchoolTimetableArchive"){u=f(r.childNodes[t]),p(u);break}}function w(n,t,i,r){var u,f;"Reference"in n?(u=resourcer[t.indexOf(n.Reference)],u?i.eventresourcer.push(u):alert("fejl5 ved indlæsning af resource for ")):"Role"in n&&"ResourceType"in n?(f=resourcetyper[r.indexOf(n.ResourceType.Reference)],f?i.eventmangler.push(new v(n.Role,f,n.Workload)):alert("fejlx v res event")):alert("fejl v res event")}function b(n,t,i,r){var e=n.Name,s=n.Id,h=n.Weight,a=n.Required=="true",c=n.CostFunction,v=n.Role,u,f,l;switch(t){case"AssignResourceConstraint":u=new y(s,e,h,c,v);break;case"AssignTimeConstraint":u=new o(s,e,h,c);break;case"PreferTimesConstraint":u=new k(s,e,h,c);break;case"SpreadEventsConstraint":u=new d(s,e,h,c)}if(u){if(n.AppliesTo.Events)if(f=n.AppliesTo,f.Events.Event instanceof Array)for(l in f.Events.Event)u.appliestogre.push(eventgrupper[r.indexOf(f.Events.Event[l].Reference)]);else u.appliestoev.push(events[r.indexOf(f.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(f=n.AppliesTo,f.EventGroups.EventGroup instanceof Array)for(l in f.EventGroups.EventGroup)u.appliestogre.push(eventgrupper[i.indexOf(f.EventGroups.EventGroup[l].Reference)]);else u.appliestogre.push(eventgrupper[i.indexOf(f.EventGroups.EventGroup.Reference)]);a?hardconstraints.push(u):softconstraints.push(u)}}var y=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.role=u,this.appliestogre=[],this.appliestoev=[]}return n}(),o,s,i,u,f,r,e,h,c,l,a,v;n.AssignResourceConstraint=y,o=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=[]}return n}(),n.AssignTimeConstraint=o;var k=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=[]}return n}(),d=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.costfunction=r,this.appliestogre=[],this.appliestoev=null}return n}(),t=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}();n.Entity=t,s=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[]}return __extends(t,n),t}(t),n.Time=s,i=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(t),n.TimeGroup=i,u=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Week=u,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Day=f,r=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(t),n.EventGroup=r,e=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(r),n.Course=e,h=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(t),n.ResourceType=h,c=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(t),n.ResourceGroup=c,l=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[]}return __extends(t,n),t}(t),n.Resource=l,a=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.time=u,this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventmangler=[]}return n}(),n.AEvent=a,v=function(){function n(n,t,i){this.role=n,this.resourcetype=t,this.workload=i,(n===null||t===null)&&alert("fejl ved indlæsning af mangel "+n+","+t.name)}return n}(),n.Mangel=v,n.readinstance=p,n.readxml=g})(instans||(instans={}))