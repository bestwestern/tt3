var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function t(n){for(var i=0,t=0,r=n.length;t<r;t++)i+=n[t];return i}function ot(n){var t,d,g,ri,b,et,at,v,ot,k,c,ti,l,wt,oi,y,si,ni,fi,p,yt,vt,ui,bt,i,a,tt;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[],resmangler=[],tidmangler=[];var p,yt,w=[],kt=[],ii=[],ei=n.Instances.Instance.Times,ct=ei.TimeGroups;if(xmlinstans=n.Instances.Instance.Id,"Week"in ct)if(t=ct.Week,t instanceof Array)for(i in t)tidsgrupper.push(new f(t[i].Id,t[i].Name)),w.push(t[i].Id);else tidsgrupper.push(new f(t.Id,t.Name)),w.push(t.Id);if("Day"in ct)if(t=ct.Day,t instanceof Array)for(i in t)tidsgrupper.push(new e(t[i].Id,t[i].Name)),w.push(t[i].Id);else tidsgrupper.push(new e(t.Id,t.Name)),w.push(t.Id);if("TimeGroup"in ct)if(t=ct.TimeGroup,t instanceof Array)for(i in t)tidsgrupper.push(new r(t[i].Id,t[i].Name)),w.push(t[i].Id);else tidsgrupper.push(new r(t.Id,t.Name)),w.push(t.Id);ct=null,t=ei.Time;for(i in t){if(d=t[i],g=new it(d.Name,d.Id),d.Week&&(b=tidsgrupper[w.indexOf(d.Week.Reference)],g.timegroups.push(b),b.timer.push(g)),d.Day&&(b=tidsgrupper[w.indexOf(d.Day.Reference)],g.timegroups.push(b),b.timer.push(g)),d.TimeGroups){ri=d.TimeGroups.TimeGroup;for(i in ri)p=ri[i],p.Reference&&(p=p.Reference),b=tidsgrupper[w.indexOf(p)],g.timegroups.push(b),b.timer.push(g)}timer.push(g),ii.push(g.id)}antaltider=timer.length;var dt=n.Instances.Instance.Resources,lt=[],pt=[];if(dt.ResourceTypes)if(t=dt.ResourceTypes.ResourceType,t instanceof Array)for(i in t)resourcetyper.push(new s(t[i].Name,t[i].Id)),lt.push(t[i].Id);else resourcetyper.push(new s(t.Name,t.Id)),lt.push(t.Id);if(dt.ResourceGroups)if(t=dt.ResourceGroups.ResourceGroup,t instanceof Array)for(i in t){var nt=t[i],gt=resourcetyper[lt.indexOf(nt.ResourceType.Reference)],v=new h(nt.Id,nt.Name,gt);resourcegrupper.push(v),gt.resourcegroups.push(v),pt.push(nt.Id)}else{var nt=t,gt=resourcetyper[lt.indexOf(nt.ResourceType.Reference)],v=new h(nt.Id,nt.Name,gt);resourcegrupper.push(v),gt.resourcegroups.push(v),pt.push(nt.Id)}t=dt.Resource;for(i in t){et=t[i],at=new rt(et.Name,et.Id,resourcetyper[lt.indexOf(et.ResourceType.Reference)]);for(ni in et.ResourceGroups.ResourceGroup)p=et.ResourceGroups.ResourceGroup[ni],(v=resourcegrupper[pt.indexOf(p)])?v===undefined?alert("fejl ved "+et.Id):(v.resourcer.push(at),at.resourcegroups.push(v)):(v=resourcegrupper[pt.indexOf(p.Reference)],v===undefined?alert("fejl ved "+et.Id):(v.resourcer.push(at),at.resourcegroups.push(v)));resourcer.push(at),kt.push(at.id)}if(antalresourcer=resourcer.length,ot=n.Instances.Instance.Events,k=[],ot.EventGroups){if(c=ot.EventGroups.Course,c)if(c instanceof Array)for(i in c)eventgrupper.push(new o(c[i].Name,c[i].Id)),k.push(c[i].Id);else eventgrupper.push(new o(c.Name,c.Id)),k.push(c.Id);if(c=ot.EventGroups.EventGroup,c)if(c instanceof Array)for(i in c)eventgrupper.push(new u(c[i].Name,c[i].Id)),k.push(c[i].Id);else eventgrupper.push(new u(c.Name,c.Id)),k.push(c.Id)}ot=ot.Event,ti=[];for(i in ot){if(l=ot[i],wt=null,l.Time){for(oi=l.Time.Reference,a=0,tt=timer.length;a<tt;a++)timer[a].id==oi&&(wt=timer[a],a=tt);wt||alert("Preassigned tid ikke fundet for "+l.Name)}if(y=new ut(l.Id,l.Name,Number(l.Duration),l.Workload,wt),wt)si=3;else for(a=0;a<y.duration;a++)y.eventtidmangler.push(new ft(y,a));l.Workload&&(ui=3);for(ni in l.Course)fi=l.Course[ni],k.indexOf(fi)>-1?(vt=eventgrupper[k.indexOf(fi)],y.eventeventgrupper.push(vt),vt.events.push(y)):alert("fejl ved indlæsning af event "+l.Name);if(l.EventGroups){c=l.EventGroups,c.EventGroup&&(c=c.EventGroup);for(i in c)p=c[i],yt=k.indexOf(p.Reference),yt==-1&&(yt=k.indexOf(p)),yt==-1?alert("fejl3 ved indlæsning af evengroups for event "+l.Name):(vt=eventgrupper[yt],y.eventeventgrupper.push(vt),vt.events.push(y))}if("Resources"in l&&l.Resources.Resource)if(l.Resources.Resource instanceof Array)for(a=0,tt=l.Resources.Resource.length;a<tt;a++)st(l.Resources.Resource[a],kt,y,lt);else st(l.Resources.Resource,kt,y,lt);wt&&y.eventresourcer.length>0&&y.eventresmangler.length>0&&(ui=2),events.push(y),ti.push(y.id)}antalevents=events.length,bt=n.Instances.Instance.Constraints;for(i in bt)if(bt[i]instanceof Array)for(a=0,tt=bt[i].length;a<tt;a++)ht(bt[i][a],i,k,ti,kt,pt,ii,w);else ht(bt[i],i,k,ti,kt,pt,ii,w)}function ct(n){function f(n){function u(n,t){i[n]?(i[n].constructor!=Array&&(i[n]=[i[n]]),i[n][i[n].length]=t):i[n]=t}for(var i={},t,r=0;t=n.attributes[r];r++)u(t.name,t.value);for(r=0;t=n.childNodes[r];r++)t.nodeType==1&&(t.childNodes.length==1&&t.firstChild.nodeType==3?u(t.nodeName,t.firstChild.nodeValue):u(t.nodeName,f(t)));return i}var r=new XMLHttpRequest,i,t,u;for(r.open("GET",n,!1),r.send(null),xmlDoc=r.responseXML,i=-1,t=0,u=xmlDoc.childNodes.length;t<u;t++)xmlDoc.childNodes[t].nodeName==="HighSchoolTimetableArchive"&&(i=t,t=u);i>-1?(xmlinstans=xmlDoc.childNodes[i].childNodes[0].nodeValue,ot(f(xmlDoc.childNodes[i]))):assert(!0,"kunne ikke læse "+n)}function st(n,t,i,r){var u,f,e,o;if("Reference"in n)u=resourcer[t.indexOf(n.Reference)],u?(i.eventresourcer.push(u),u.preass||(u.preass=[]),u.preass.push(i)):alert("fejl5 ved indlæsning af resource for ");else if("Role"in n&&"ResourceType"in n)if(f=resourcetyper[r.indexOf(n.ResourceType.Reference)],f)if(i.preasigntime)i.eventresmangler.push(new c(n.Role,f,i,null,n.Workload));else for(e=0,o=i.duration;e<o;e++)i.eventresmangler.push(new c(n.Role,f,i,e,n.Workload));else alert("fejlx v res event");else alert("fejl v res event")}function ht(n,t,i,r,u,f,e,o){var ft=n.Name,st=n.Id,ht=n.Weight,ii=n.Required=="true",ct=n.CostFunction,kt=n.Role,s,lt,wt,ri,at,vt,c,ut,yt,it,dt,bt,gt,ni,ti,pt,h,ot,rt;switch(t){case"AssignResourceConstraint":s=new v(st,ft,ht,ct,kt);break;case"AssignTimeConstraint":s=new y(st,ft,ht,ct);break;case"AvoidUnavailableTimesConstraint":s=new a(st,ft,ht,ct);break;case"AvoidClashesConstraint":s=new et(st,ft,ht,ct);break;case"AvoidSplitAssignmentsConstraint":s=new l(st,ft,ht,ct,kt);break;case"DistributeSplitEventsConstraint":s=new p(st,ft,ht,ct);break;case"LimitBusyTimesConstraint":s=new w(st,ft,ht,ct);break;case"LimitWorkloadConstraint":s=new b(st,ft,ht,ct);break;case"LinkEventsConstraint":s=new k(st,ft,ht,ct);break;case"PreferTimesConstraint":s=new g(st,ft,ht,ct);break;case"SpreadEventsConstraint":s=new tt(st,ft,ht,ct);break;case"PreferResourcesConstraint":s=new d(st,ft,ht,ct,kt);break;case"SplitEventsConstraint":s=new nt(st,ft,ht,ct);break;case"DistributeSplitEventsConstraint":assert(ft,!0)}if(s){if("MinimumAmount"in n&&(s.minimumamount=n.MinimumAmount),"MinimumDuration"in n&&(s.minimumduration=n.MinimumDuration),"MaximumDuration"in n&&(s.maximumduration=n.MaximumDuration),"Minimum"in n&&(s.minimum=n.Minimum),"Maximum"in n&&(s.maximum=n.Maximum),"MaximumAmount"in n&&(s.maximumamount=n.MaximumAmount),"Duration"in n&&(s.duration=n.Duration),n.AppliesTo.Events)if(c=n.AppliesTo,c.Events.Event instanceof Array)for(ut in c.Events.Event)s.appliestoev.push(events[r.indexOf(c.Events.Event[ut].Reference)]);else s.appliestoev.push(events[r.indexOf(c.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(c=n.AppliesTo,c.EventGroups.EventGroup instanceof Array){for(ut in c.EventGroups.EventGroup)if(lt=eventgrupper[i.indexOf(c.EventGroups.EventGroup[ut].Reference)],s.appliestoevgrou.push(lt),s.appliestoev)for(h=0,it=lt.events.length;h<it;h++)s.appliestoev.indexOf(lt.events[h])==-1&&s.appliestoev.push(lt.events[h])}else if(lt=eventgrupper[i.indexOf(c.EventGroups.EventGroup.Reference)],s.appliestoevgrou.push(lt),s.appliestoev)for(h=0,it=lt.events.length;h<it;h++)s.appliestoev.indexOf(lt.events[h])==-1&&s.appliestoev.push(lt.events[h]);if(n.Times)if(wt=n.Times.Time,wt)if(wt instanceof Array)for(ut in wt)s.timer.push(timer[e.indexOf(wt[ut].Reference)]);else s.timer.push(timer[e.indexOf(wt.Reference)]);else ri=4;if(n.TimeGroups)if(at=n.TimeGroups.TimeGroup,at instanceof Array){for(ut in at)if(vt=tidsgrupper[o.indexOf(at[ut].Reference)],s.timegroups.push(vt),"Minimum"in at[ut]&&(s.timegroupminimum.push(at[ut].Minimum),s.timegroupmaximum.push(at[ut].Maximum)),s.timer)for(h=0,it=vt.timer.length;h<it;h++)s.timer.indexOf(vt.timer[h])==-1&&s.timer.push(vt.timer[h])}else if("Minimum"in at&&(s.timegroupminimum.push(at.Minimum),s.timegroupmaximum.push(at.Maximum)),vt=tidsgrupper[o.indexOf(at.Reference)],s.timegroups.push(vt),s.timer)for(h=0,it=vt.timer.length;h<it;h++)s.timer.indexOf(vt.timer[h])==-1&&s.timer.push(vt.timer[h]);if(n.Resources||n.AppliesTo.Resources)if(c=n.Resources?n.Resources.Resource:n.AppliesTo.Resources.Resource,c instanceof Array)for(ut in c)s.appliestores.push(resourcer[u.indexOf(c[ut].Reference)]);else s.appliestores.push(resourcer[u.indexOf(c.Reference)]);if(n.AppliesTo.ResourceGroups||n.ResourceGroups)if(c=n.ResourceGroups?n.ResourceGroups:n.AppliesTo.ResourceGroups,c.ResourceGroup instanceof Array)for(ut in c.ResourceGroup)for(yt=resourcegrupper[f.indexOf(c.ResourceGroup[ut].Reference)],s.appliestoresgrou.push(yt),h=0,it=yt.resourcer.length;h<it;h++)s.appliestores.indexOf(yt.resourcer[h])==-1&&s.appliestores.push(yt.resourcer[h]);else for(yt=resourcegrupper[f.indexOf(c.ResourceGroup.Reference)],s.appliestoresgrou.push(yt),h=0,it=yt.resourcer.length;h<it;h++)s.appliestores.indexOf(yt.resourcer[h])==-1&&s.appliestores.push(yt.resourcer[h]);switch(t){case"AssignResourceConstraint":for(pt=s.appliestoev,h=0;h<pt.length;h++)for(ot=pt[h].eventresmangler,rt=0;rt<ot.length;rt++)ot[rt].role==s.role&&s.appliestoresmangler.push(ot[rt]);break;case"PreferResourcesConstraint":for(pt=s.appliestoev,h=0;h<pt.length;h++)for(ot=pt[h].eventresmangler,rt=0;rt<ot.length;rt++)ot[rt].role==s.role&&s.appliestoresmangler.push(ot[rt]);break;case"AvoidSplitAssignmentsConstraint":for(dt=s.appliestoevgrou,bt=0;bt<dt.length;bt++){for(gt=dt[bt],ni=[],ti=0;ti<gt.events.length;ti++)for(pt=gt.events,h=0;h<pt.length;h++)for(ot=pt[h].eventresmangler,rt=0;rt<ot.length;rt++)ot[rt].role==s.role&&ni.push(ot[rt]);s.arraymedarrayafresmangler.push(ni)}}ii?hardconstraints.push(s):softconstraints.push(s)}}var et=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoresgrou=[],this.appliestores=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),l,a,v,y,p,w,b,k,d,g,nt,tt,i,it,r,f,e,u,o,s,h,rt,ut,ft,c;n.AvoidClashesConstraint=et,l=function(){function n(n,i,r,u,f){this.id=n,this.name=i,this.weight=r,this.role=f,this.appliestoevgrou=[],this.arraymedarrayafresmangler=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.AvoidSplitAssignmentsConstraint=l,a=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoresgrou=[],this.appliestores=[],this.timegroups=[],this.timer=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.AvoidUnavailableTimesConstraint=a,v=function(){function n(n,i,r,u,f){this.id=n,this.name=i,this.weight=r,this.role=f,this.appliestoevgrou=[],this.appliestoresmangler=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.AssignResourceConstraint=v,y=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoevgrou=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.AssignTimeConstraint=y,p=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r;switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}this.appliestoevgrou=[],this.appliestoev=[]}return n}(),n.DistributeSplitEventsConstraint=p,w=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoresgrou=[],this.appliestores=[],this.timegroups=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.LimitBusyTimesConstraint=w,b=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoresgrou=[],this.appliestores=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.LimitWorkloadConstraint=b,k=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoevgrou=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.LinkEventsConstraint=k,d=function(){function n(n,i,r,u,f){this.id=n,this.name=i,this.weight=r,this.role=f,this.appliestoevgrou=[],this.appliestoev=[],this.appliestoresgrou=[],this.appliestores=[],this.appliestoresmangler=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.PreferResourcesConstraint=d,g=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r,this.appliestoevgrou=[],this.appliestoev=[],this.timegroups=[],this.timer=[];switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}}return n}(),n.PreferTimesConstraint=g,nt=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r;switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}this.appliestoevgrou=[],this.appliestoev=[]}return n}(),n.SplitEventsConstraint=nt,tt=function(){function n(n,i,r,u){this.id=n,this.name=i,this.weight=r;switch(u.toLowerCase()){case"sum":this.costfunction=t;break;default:alert("costfunction mangler!"+u)}this.appliestoevgrou=[],this.timegroups=[],this.timegroupmaximum=[],this.timegroupminimum=[]}return n}(),n.SpreadEventsConstraint=tt,i=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}(),n.Entity=i,it=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[],this.index=timer.length}return __extends(t,n),t}(i),n.Time=it,r=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.TimeGroup=r,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(r),n.Week=f,e=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(r),n.Day=e,u=function(n){function t(t,i){n.call(this,i,t),this.events=[]}return __extends(t,n),t}(i),n.EventGroup=u,o=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(u),n.Course=o,s=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(i),n.ResourceType=s,h=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(i),n.ResourceGroup=h,rt=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[],this.index=resourcer.length}return __extends(t,n),t}(i),n.Resource=rt,ut=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.preasigntime=u,this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventresmangler=[],this.eventtidmangler=[],this.index=events.length}return n}(),n.AEvent=ut,ft=function(){function n(n,t){this.aevent=n,this.durationindex=t,(n===null||t===null)&&alert("fejl ved indlæsningh af tidmangel "),this.index=tidmangler.length,tidmangler.push(this)}return n}(),n.TidMangel=ft,c=function(){function n(n,t,i,r,u){this.role=n,this.resourcetype=t,this.aevent=i,this.durationindex=r,this.workload=u,(n===null||t===null)&&alert("fejl ved indlæsningh af mangel "+n+","+t.name),this.index=resmangler.length,resmangler.push(this)}return n}(),n.ResMangel=c,n.readinstance=ot,n.readxml=ct})(instans||(instans={}))