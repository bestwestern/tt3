var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function u(n){for(var i=0,t=0,r=n.length;t<r;t++)i+=n[t];return i}function w(n){var t,tt,ft,ni,d,et,ct,p,ot,g,c,dt,y,rt,kt,ti,w,at,lt,vt,u,ut,wt;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[];var w,at,nt=[],gt=[],ii=n.Instances.Instance.Times,st=ii.TimeGroups;if("Week"in st)if(t=st.Week,t instanceof Array)for(u in t)tidsgrupper.push(new f(t[u].Id,t[u].Name)),nt.push(t[u].Id);else tidsgrupper.push(new f(t.Id,t.Name)),nt.push(t.Id);if("Day"in st)if(t=st.Day,t instanceof Array)for(u in t)tidsgrupper.push(new e(t[u].Id,t[u].Name)),nt.push(t[u].Id);else tidsgrupper.push(new e(t.Id,t.Name)),nt.push(t.Id);if("TimeGroup"in st)if(t=st.TimeGroup,t instanceof Array)for(u in t)tidsgrupper.push(new i(t[u].Id,t[u].Name)),nt.push(t[u].Id);else tidsgrupper.push(new i(t.Id,t.Name)),nt.push(t.Id);st=null,t=ii.Time;for(u in t){if(tt=t[u],ft=new l(tt.Id,tt.Name),tt.Week&&(d=tidsgrupper[nt.indexOf(tt.Week.Reference)],ft.timegroups.push(d),d.timer.push(ft)),tt.Day&&(d=tidsgrupper[nt.indexOf(tt.Day.Reference)],ft.timegroups.push(d),d.timer.push(ft)),tt.TimeGroups){ni=tt.TimeGroups.TimeGroup;for(u in ni)w=ni[u],w.Reference&&(w=w.Reference),d=tidsgrupper[nt.indexOf(w)],ft.timegroups.push(d),d.timer.push(ft)}timer.push(ft)}var yt=n.Instances.Instance.Resources,ht=[],bt=[];if(yt.ResourceTypes)if(t=yt.ResourceTypes.ResourceType,t instanceof Array)for(u in t)resourcetyper.push(new s(t[u].Name,t[u].Id)),ht.push(t[u].Id);else resourcetyper.push(new s(t.Name,t.Id)),ht.push(t.Id);if(yt.ResourceGroups)if(t=yt.ResourceGroups.ResourceGroup,t instanceof Array)for(u in t){var it=t[u],pt=resourcetyper[ht.indexOf(it.ResourceType.Reference)],p=new h(it.Id,it.Name,pt);resourcegrupper.push(p),pt.resourcegroups.push(p),bt.push(it.Id)}else{var it=t,pt=resourcetyper[ht.indexOf(it.ResourceType.Reference)],p=new h(it.Id,it.Name,pt);resourcegrupper.push(p),pt.resourcegroups.push(p),bt.push(it.Id)}t=yt.Resource;for(u in t){et=t[u],ct=new a(et.Name,et.Id,resourcetyper[ht.indexOf(et.ResourceType.Reference)]);for(kt in et.ResourceGroups.ResourceGroup)w=et.ResourceGroups.ResourceGroup[kt],(p=resourcegrupper[bt.indexOf(w)])?p===undefined?alert("fejl ved "+et.Id):(p.resourcer.push(ct),ct.resourcegroups.push(p)):(p=resourcegrupper[bt.indexOf(w.Reference)],p===undefined?alert("fejl ved "+et.Id):(p.resourcer.push(ct),ct.resourcegroups.push(p)));resourcer.push(ct),gt.push(ct.id)}if(ot=n.Instances.Instance.Events,g=[],ot.EventGroups){if(c=ot.EventGroups.Course,c)if(c instanceof Array)for(u in c)eventgrupper.push(new o(c[u].Name,c[u].Id)),g.push(c[u].Id);else eventgrupper.push(new o(c.Name,c.Id)),g.push(c.Id);if(c=ot.EventGroups.EventGroup,c)if(c instanceof Array)for(u in c)eventgrupper.push(new r(c[u].Name,c[u].Id)),g.push(c[u].Id);else eventgrupper.push(new r(c.Name,c.Id)),g.push(c.Id)}ot=ot.Event,dt=[];for(u in ot){y=ot[u],rt=new v(y.Id,y.Name,y.Duration);for(kt in y.Course)ti=y.Course[kt],g.indexOf(ti)>-1?(lt=eventgrupper[g.indexOf(ti)],rt.eventeventgrupper.push(lt),lt.events.push(rt)):alert("fejl ved indlæsning af event "+y.Name);if(y.EventGroups){c=y.EventGroups,c.EventGroup&&(c=c.EventGroup);for(u in c)w=c[u],at=g.indexOf(w.Reference),at==-1&&(at=g.indexOf(w)),at==-1?alert("fejl3 ved indlæsning af evengroups for event "+y.Name):(lt=eventgrupper[at],rt.eventeventgrupper.push(lt),lt.events.push(rt))}if("Resources"in y&&y.Resources.Resource)if(y.Resources.Resource instanceof Array)for(ut=0,wt=y.Resources.Resource.length;ut<wt;ut++)b(y.Resources.Resource[ut],gt,rt,ht);else b(y.Resources.Resource,gt,rt,ht);events.push(rt),dt.push(rt.id)}vt=n.Instances.Instance.Constraints;for(u in vt)if(vt[u]instanceof Array)for(ut=0,wt=vt[u].length;ut<wt;ut++)k(vt[u][ut],u,g,dt);else k(vt[u],u,g,dt)}function nt(n){function f(n){function u(n,t){i[n]?(i[n].constructor!=Array&&(i[n]=[i[n]]),i[n][i[n].length]=t):i[n]=t}for(var i={},t,r=0;t=n.attributes[r];r++)u(t.name,t.value);for(r=0;t=n.childNodes[r];r++)t.nodeType==1&&(t.childNodes.length==1&&t.firstChild.nodeType==3?u(t.nodeName,t.firstChild.nodeValue):u(t.nodeName,f(t)));return i}var i,r,u,t;for(i=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.open("GET",n,!1),i.send(),r=i.responseXML,t=0;t<r.childNodes.length;t++)if(r.childNodes[t].baseName==="HighSchoolTimetableArchive"){u=f(r.childNodes[t]),w(u);break}}function b(n,t,i,r){var u,f;"Reference"in n?(u=resourcer[t.indexOf(n.Reference)],u?i.eventresourcer.push(u):alert("fejl5 ved indlæsning af resource for ")):"Role"in n&&"ResourceType"in n?(f=resourcetyper[r.indexOf(n.ResourceType.Reference)],f?i.eventmangler.push(new y(n.Role,f,n.Workload)):alert("fejlx v res event")):alert("fejl v res event")}function k(n,t,i,r){var h=n.Name,l=n.Id,a=n.Weight,w=n.Required=="true",v=n.CostFunction,b=n.Role,u,f,y,e,o,s;switch(t){case"AssignResourceConstraint":u=new p(l,h,a,v,b);break;case"AssignTimeConstraint":u=new c(l,h,a,v);break;case"PreferTimesConstraint":u=new d(l,h,a,v);break;case"SpreadEventsConstraint":u=new g(l,h,a,v)}if(u){if(n.AppliesTo.Events)if(f=n.AppliesTo,f.Events.Event instanceof Array)for(y in f.Events.Event)u.appliestogre.push(eventgrupper[r.indexOf(f.Events.Event[y].Reference)]);else u.appliestoev.push(events[r.indexOf(f.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(f=n.AppliesTo,f.EventGroups.EventGroup instanceof Array)for(y in f.EventGroups.EventGroup)for(e=eventgrupper[i.indexOf(f.EventGroups.EventGroup[y].Reference)],u.appliestogre.push(e),o=0,s=e.events.length;o<s;o++)u.appliestoev.indexOf(e.events[o])==-1&&u.appliestoev.push(e.events[o]);else for(e=eventgrupper[i.indexOf(f.EventGroups.EventGroup.Reference)],u.appliestogre.push(e),o=0,s=e.events.length;o<s;o++)u.appliestoev.indexOf(e.events[o])==-1&&u.appliestoev.push(e.events[o]);w?hardconstraints.push(u):softconstraints.push(u)}}var p=function(){function n(n,t,i,r,f){this.id=n,this.name=t,this.weight=i,this.role=f,this.appliestogre=[],this.appliestoev=[],this.appliestoma=[];switch(r.toLowerCase()){case"sum":this.costfunction=u}}return n}(),c,l,i,f,e,r,o,s,h,a,v,y;n.AssignResourceConstraint=p,c=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(r.toLowerCase()){case"sum":this.costfunction=u}}return n}(),n.AssignTimeConstraint=c;var d=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(r.toLowerCase()){case"sum":this.costfunction=u}}return n}(),g=function(){function n(n,t,i,r){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(r.toLowerCase()){case"sum":this.costfunction=u}}return n}(),t=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}();n.Entity=t,l=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[]}return __extends(t,n),t}(t),n.Time=l,i=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(t),n.TimeGroup=i,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Week=f,e=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Day=e,r=function(n){function t(t,i){n.call(this,i,t),this.events=[]}return __extends(t,n),t}(t),n.EventGroup=r,o=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(r),n.Course=o,s=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(t),n.ResourceType=s,h=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(t),n.ResourceGroup=h,a=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[]}return __extends(t,n),t}(t),n.Resource=a,v=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.preasigntime=u,this.solevent=[],this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventmangler=[]}return n}(),n.AEvent=v,y=function(){function n(n,t,i){this.role=n,this.resourcetype=t,this.workload=i,(n===null||t===null)&&alert("fejl ved indlæsningh af mangel "+n+","+t.name)}return n}(),n.Mangel=y,n.readinstance=w,n.readxml=nt})(instans||(instans={}))