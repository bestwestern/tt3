var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function r(n){for(var i=0,t=0,r=n.length;t<r;t++)i+=n[t];return i}function g(n){var t,ut,ft,ri,it,st,at,v,ht,rt,c,ti,a,gt,ei,d,ni,ui,k,yt,vt,wt,r,l,ot;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[],resmangler=[],tidmangler=[];var k,yt,g=[],bt=[],ii=[],fi=n.Instances.Instance.Times,ct=fi.TimeGroups;if(xmlinstans=n.Instances.Instance.Id,"Week"in ct)if(t=ct.Week,t instanceof Array)for(r in t)tidsgrupper.push(new f(t[r].Id,t[r].Name)),g.push(t[r].Id);else tidsgrupper.push(new f(t.Id,t.Name)),g.push(t.Id);if("Day"in ct)if(t=ct.Day,t instanceof Array)for(r in t)tidsgrupper.push(new e(t[r].Id,t[r].Name)),g.push(t[r].Id);else tidsgrupper.push(new e(t.Id,t.Name)),g.push(t.Id);if("TimeGroup"in ct)if(t=ct.TimeGroup,t instanceof Array)for(r in t)tidsgrupper.push(new i(t[r].Id,t[r].Name)),g.push(t[r].Id);else tidsgrupper.push(new i(t.Id,t.Name)),g.push(t.Id);ct=null,t=fi.Time;for(r in t){if(ut=t[r],ft=new y(ut.Id,ut.Name),ut.Week&&(it=tidsgrupper[g.indexOf(ut.Week.Reference)],ft.timegroups.push(it),it.timer.push(ft)),ut.Day&&(it=tidsgrupper[g.indexOf(ut.Day.Reference)],ft.timegroups.push(it),it.timer.push(ft)),ut.TimeGroups){ri=ut.TimeGroups.TimeGroup;for(r in ri)k=ri[r],k.Reference&&(k=k.Reference),it=tidsgrupper[g.indexOf(k)],ft.timegroups.push(it),it.timer.push(ft)}timer.push(ft),ii.push(ft.id)}var kt=n.Instances.Instance.Resources,lt=[],pt=[];if(kt.ResourceTypes)if(t=kt.ResourceTypes.ResourceType,t instanceof Array)for(r in t)resourcetyper.push(new s(t[r].Name,t[r].Id)),lt.push(t[r].Id);else resourcetyper.push(new s(t.Name,t.Id)),lt.push(t.Id);if(kt.ResourceGroups)if(t=kt.ResourceGroups.ResourceGroup,t instanceof Array)for(r in t){var et=t[r],dt=resourcetyper[lt.indexOf(et.ResourceType.Reference)],v=new h(et.Id,et.Name,dt);resourcegrupper.push(v),dt.resourcegroups.push(v),pt.push(et.Id)}else{var et=t,dt=resourcetyper[lt.indexOf(et.ResourceType.Reference)],v=new h(et.Id,et.Name,dt);resourcegrupper.push(v),dt.resourcegroups.push(v),pt.push(et.Id)}t=kt.Resource;for(r in t){st=t[r],at=new p(st.Name,st.Id,resourcetyper[lt.indexOf(st.ResourceType.Reference)]);for(ni in st.ResourceGroups.ResourceGroup)k=st.ResourceGroups.ResourceGroup[ni],(v=resourcegrupper[pt.indexOf(k)])?v===undefined?alert("fejl ved "+st.Id):(v.resourcer.push(at),at.resourcegroups.push(v)):(v=resourcegrupper[pt.indexOf(k.Reference)],v===undefined?alert("fejl ved "+st.Id):(v.resourcer.push(at),at.resourcegroups.push(v)));resourcer.push(at),bt.push(at.id)}if(ht=n.Instances.Instance.Events,rt=[],ht.EventGroups){if(c=ht.EventGroups.Course,c)if(c instanceof Array)for(r in c)eventgrupper.push(new o(c[r].Name,c[r].Id)),rt.push(c[r].Id);else eventgrupper.push(new o(c.Name,c.Id)),rt.push(c.Id);if(c=ht.EventGroups.EventGroup,c)if(c instanceof Array)for(r in c)eventgrupper.push(new u(c[r].Name,c[r].Id)),rt.push(c[r].Id);else eventgrupper.push(new u(c.Name,c.Id)),rt.push(c.Id)}ht=ht.Event,ti=[];for(r in ht){if(a=ht[r],gt=null,a.Time){for(ei=a.Time.Reference,l=0,ot=timer.length;l<ot;l++)timer[l].id==ei&&(gt=timer[l],l=ot);gt||alert("Preassigned tid ikke fundet for "+a.Name)}if(d=new w(a.Id,a.Name,Number(a.Duration),a.Workload,gt),!gt)for(l=0;l<d.duration;l++)d.eventtidmangler.push(new b(d,l));for(ni in a.Course)ui=a.Course[ni],rt.indexOf(ui)>-1?(vt=eventgrupper[rt.indexOf(ui)],d.eventeventgrupper.push(vt),vt.events.push(d)):alert("fejl ved indlæsning af event "+a.Name);if(a.EventGroups){c=a.EventGroups,c.EventGroup&&(c=c.EventGroup);for(r in c)k=c[r],yt=rt.indexOf(k.Reference),yt==-1&&(yt=rt.indexOf(k)),yt==-1?alert("fejl3 ved indlæsning af evengroups for event "+a.Name):(vt=eventgrupper[yt],d.eventeventgrupper.push(vt),vt.events.push(d))}if("Resources"in a&&a.Resources.Resource)if(a.Resources.Resource instanceof Array)for(l=0,ot=a.Resources.Resource.length;l<ot;l++)nt(a.Resources.Resource[l],bt,d,lt);else nt(a.Resources.Resource,bt,d,lt);events.push(d),ti.push(d.id)}antalevents=events.length,wt=n.Instances.Instance.Constraints;for(r in wt)if(wt[r]instanceof Array)for(l=0,ot=wt[r].length;l<ot;l++)tt(wt[r][l],r,rt,ti,bt,pt,ii,g);else tt(wt[r],r,rt,ti,bt,pt,ii,g)}function it(n){function f(n){function u(n,t){i[n]?(i[n].constructor!=Array&&(i[n]=[i[n]]),i[n][i[n].length]=t):i[n]=t}for(var i={},t,r=0;t=n.attributes[r];r++)u(t.name,t.value);for(r=0;t=n.childNodes[r];r++)t.nodeType==1&&(t.childNodes.length==1&&t.firstChild.nodeType==3?u(t.nodeName,t.firstChild.nodeValue):u(t.nodeName,f(t)));return i}var r=new XMLHttpRequest,i,t,u;for(r.open("GET",n,!1),r.send(null),xmlDoc=r.responseXML,i=-1,t=0,u=xmlDoc.childNodes.length;t<u;t++)xmlDoc.childNodes[t].nodeName==="HighSchoolTimetableArchive"&&(i=t,t=u);i>-1?(xmlinstans=xmlDoc.childNodes[i].childNodes[0].nodeValue,g(f(xmlDoc.childNodes[i]))):assert(!0,"kunne ikke læse "+n)}function nt(n,t,i,r){var f,e,u,o;if("Reference"in n)f=resourcer[t.indexOf(n.Reference)],f?i.eventresourcer.push(f):alert("fejl5 ved indlæsning af resource for ");else if("Role"in n&&"ResourceType"in n)if(e=resourcetyper[r.indexOf(n.ResourceType.Reference)],e)for(u=0,o=i.duration;u<o;u++)i.eventresmangler.push(new k(n.Role,e,i,u,n.Workload));else alert("fejlx v res event");else alert("fejl v res event")}function tt(n,t,i,r,u,f,e,o){var g=n.Name,nt=n.Id,tt=n.Weight,et=n.Required=="true",it=n.CostFunction,ot=n.Role,s,p,rt,ut,b,h,w,y,k,ft;switch(t){case"AssignResourceConstraint":s=new d(nt,g,tt,it,ot);break;case"AssignTimeConstraint":s=new c(nt,g,tt,it);break;case"PreferTimesConstraint":s=new a(nt,g,tt,it);break;case"SpreadEventsConstraint":s=new v(nt,g,tt,it);break;case"PreferResourcesConstraint":s=new l(nt,g,tt,it);break;case"DistributeSplitEventsConstraint":assert(g,!0)}if(s){if(n.AppliesTo.Events)if(y=n.AppliesTo,y.Events.Event instanceof Array)for(k in y.Events.Event)s.appliestogre.push(eventgrupper[r.indexOf(y.Events.Event[k].Reference)]);else s.appliestoev.push(events[r.indexOf(y.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(y=n.AppliesTo,y.EventGroups.EventGroup instanceof Array)for(k in y.EventGroups.EventGroup)for(p=eventgrupper[i.indexOf(y.EventGroups.EventGroup[k].Reference)],s.appliestogre.push(p),h=0,w=p.events.length;h<w;h++)s.appliestoev.indexOf(p.events[h])==-1&&s.appliestoev.push(p.events[h]);else for(p=eventgrupper[i.indexOf(y.EventGroups.EventGroup.Reference)],s.appliestogre.push(p),h=0,w=p.events.length;h<w;h++)s.appliestoev.indexOf(p.events[h])==-1&&s.appliestoev.push(p.events[h]);if(n.Times)if(rt=n.Times.Time,rt instanceof Array)for(k in rt)s.timer.push(rt[k].Reference);else s.timer.push(rt.Reference);if(n.TimeGroups)if(ut=n.TimeGroups.TimeGroup,ut instanceof Array)for(k in ut)for(b=tidsgrupper[o.indexOf(ut[k].Reference)],s.timegroups.push(b),h=0,w=b.timer.length;h<w;h++)s.timer.indexOf(b.timer[h])==-1&&s.timer.push(b.timer[h]);else for(b=tidsgrupper[o.indexOf(ut.Reference)],s.timegroups.push(b),h=0,w=b.timer.length;h<w;h++)s.timer.indexOf(b.timer[h])==-1&&s.timer.push(b.timer[h]);if(n.Resource,n.ResourceGroups)if(y=n.ResourceGroups,y.ResourceGroup instanceof Array)for(k in y.ResourceGroup)ft=resourcegrupper[f.indexOf(y.ResourceGroup[k].Reference)],s.appliestogrr.push(ft);else ft=resourcegrupper[f.indexOf(y.ResourceGroup.Reference)],s.appliestogrr.push(ft);et?hardconstraints.push(s):softconstraints.push(s)}}var d=function(){function n(n,t,i,u,f){this.id=n,this.name=t,this.weight=i,this.role=f,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),c,l,a,v,t,y,i,f,e,u,o,s,h,p,w,b,k;n.AssignResourceConstraint=d,c=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),n.AssignTimeConstraint=c,l=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[],this.appliestogrr=[],this.appliestores=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),n.PreferResourcesConstraint=l,a=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[],this.timegroups=[],this.timer=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),n.PreferTimesConstraint=a,v=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.timegroups=[],this.timer=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),n.SpreadEventsConstraint=v,t=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}(),n.Entity=t,y=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[],this.index=timer.length}return __extends(t,n),t}(t),n.Time=y,i=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(t),n.TimeGroup=i,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Week=f,e=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Day=e,u=function(n){function t(t,i){n.call(this,i,t),this.events=[]}return __extends(t,n),t}(t),n.EventGroup=u,o=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(u),n.Course=o,s=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(t),n.ResourceType=s,h=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(t),n.ResourceGroup=h,p=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[],this.index=resourcer.length}return __extends(t,n),t}(t),n.Resource=p,w=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.preasigntime=u,this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventresmangler=[],this.eventtidmangler=[],this.index=events.length}return n}(),n.AEvent=w,b=function(){function n(n,t){this.aevent=n,this.durationindex=t,(n===null||t===null)&&alert("fejl ved indlæsningh af tidmangel "),this.index=tidmangler.length,tidmangler.push(this)}return n}(),n.TidMangel=b,k=function(){function n(n,t,i,r,u){this.role=n,this.resourcetype=t,this.aevent=i,this.durationindex=r,this.workload=u,(n===null||t===null)&&alert("fejl ved indlæsningh af mangel "+n+","+t.name),this.index=resmangler.length,resmangler.push(this)}return n}(),n.ResMangel=k,n.readinstance=g,n.readxml=it})(instans||(instans={}))