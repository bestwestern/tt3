var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},instans;(function(n){function r(n){for(var i=0,t=0,r=n.length;t<r;t++)i+=n[t];return i}function tt(n){var t,ut,ot,ii,tt,st,at,d,ht,it,c,ti,w,gt,fi,nt,ni,ri,g,yt,vt,wt,r,p,et;hardconstraints=[],softconstraints=[],timer=[],tidsgrupper=[],events=[],resourcegrupper=[],resourcetyper=[],resourcer=[],eventgrupper=[],resmangler=[],tidmangler=[];var g,yt,rt=[],bt=[],ui=n.Instances.Instance.Times,ct=ui.TimeGroups;if("Week"in ct)if(t=ct.Week,t instanceof Array)for(r in t)tidsgrupper.push(new f(t[r].Id,t[r].Name)),rt.push(t[r].Id);else tidsgrupper.push(new f(t.Id,t.Name)),rt.push(t.Id);if("Day"in ct)if(t=ct.Day,t instanceof Array)for(r in t)tidsgrupper.push(new e(t[r].Id,t[r].Name)),rt.push(t[r].Id);else tidsgrupper.push(new e(t.Id,t.Name)),rt.push(t.Id);if("TimeGroup"in ct)if(t=ct.TimeGroup,t instanceof Array)for(r in t)tidsgrupper.push(new i(t[r].Id,t[r].Name)),rt.push(t[r].Id);else tidsgrupper.push(new i(t.Id,t.Name)),rt.push(t.Id);ct=null,t=ui.Time;for(r in t){if(ut=t[r],ot=new l(ut.Id,ut.Name),ut.Week&&(tt=tidsgrupper[rt.indexOf(ut.Week.Reference)],ot.timegroups.push(tt),tt.timer.push(ot)),ut.Day&&(tt=tidsgrupper[rt.indexOf(ut.Day.Reference)],ot.timegroups.push(tt),tt.timer.push(ot)),ut.TimeGroups){ii=ut.TimeGroups.TimeGroup;for(r in ii)g=ii[r],g.Reference&&(g=g.Reference),tt=tidsgrupper[rt.indexOf(g)],ot.timegroups.push(tt),tt.timer.push(ot)}timer.push(ot)}var kt=n.Instances.Instance.Resources,lt=[],pt=[];if(kt.ResourceTypes)if(t=kt.ResourceTypes.ResourceType,t instanceof Array)for(r in t)resourcetyper.push(new s(t[r].Name,t[r].Id)),lt.push(t[r].Id);else resourcetyper.push(new s(t.Name,t.Id)),lt.push(t.Id);if(kt.ResourceGroups)if(t=kt.ResourceGroups.ResourceGroup,t instanceof Array)for(r in t){var ft=t[r],dt=resourcetyper[lt.indexOf(ft.ResourceType.Reference)],d=new h(ft.Id,ft.Name,dt);resourcegrupper.push(d),dt.resourcegroups.push(d),pt.push(ft.Id)}else{var ft=t,dt=resourcetyper[lt.indexOf(ft.ResourceType.Reference)],d=new h(ft.Id,ft.Name,dt);resourcegrupper.push(d),dt.resourcegroups.push(d),pt.push(ft.Id)}t=kt.Resource;for(r in t){st=t[r],at=new a(st.Name,st.Id,resourcetyper[lt.indexOf(st.ResourceType.Reference)]);for(ni in st.ResourceGroups.ResourceGroup)g=st.ResourceGroups.ResourceGroup[ni],(d=resourcegrupper[pt.indexOf(g)])?d===undefined?alert("fejl ved "+st.Id):(d.resourcer.push(at),at.resourcegroups.push(d)):(d=resourcegrupper[pt.indexOf(g.Reference)],d===undefined?alert("fejl ved "+st.Id):(d.resourcer.push(at),at.resourcegroups.push(d)));resourcer.push(at),bt.push(at.id)}if(ht=n.Instances.Instance.Events,it=[],ht.EventGroups){if(c=ht.EventGroups.Course,c)if(c instanceof Array)for(r in c)eventgrupper.push(new o(c[r].Name,c[r].Id)),it.push(c[r].Id);else eventgrupper.push(new o(c.Name,c.Id)),it.push(c.Id);if(c=ht.EventGroups.EventGroup,c)if(c instanceof Array)for(r in c)eventgrupper.push(new u(c[r].Name,c[r].Id)),it.push(c[r].Id);else eventgrupper.push(new u(c.Name,c.Id)),it.push(c.Id)}ht=ht.Event,ti=[];for(r in ht){if(w=ht[r],gt=null,w.Time){for(fi=w.Time.Reference,p=0,et=timer.length;p<et;p++)timer[p].id==fi&&(gt=timer[p],p=et);gt||alert("Preassigned tid ikke fundet for "+w.Name)}if(nt=new v(w.Id,w.Name,Number(w.Duration),w.Workload,gt),!gt)for(p=0;p<nt.duration;p++)nt.eventtidmangler.push(new y(nt,p));for(ni in w.Course)ri=w.Course[ni],it.indexOf(ri)>-1?(vt=eventgrupper[it.indexOf(ri)],nt.eventeventgrupper.push(vt),vt.events.push(nt)):alert("fejl ved indlæsning af event "+w.Name);if(w.EventGroups){c=w.EventGroups,c.EventGroup&&(c=c.EventGroup);for(r in c)g=c[r],yt=it.indexOf(g.Reference),yt==-1&&(yt=it.indexOf(g)),yt==-1?alert("fejl3 ved indlæsning af evengroups for event "+w.Name):(vt=eventgrupper[yt],nt.eventeventgrupper.push(vt),vt.events.push(nt))}if("Resources"in w&&w.Resources.Resource)if(w.Resources.Resource instanceof Array)for(p=0,et=w.Resources.Resource.length;p<et;p++)b(w.Resources.Resource[p],bt,nt,lt);else b(w.Resources.Resource,bt,nt,lt);events.push(nt),ti.push(nt.id)}wt=n.Instances.Instance.Constraints;for(r in wt)if(wt[r]instanceof Array)for(p=0,et=wt[r].length;p<et;p++)k(wt[r][p],r,it,ti,bt,pt);else k(wt[r],r,it,ti,bt,pt)}function it(n){var i=new XMLHttpRequest,t,r,u,f;for(i.open("GET",n,!1),i.send(null),t=i.responseXML,r=0;u=t.attributes[r];r++)console.log(u.value);for(f in t[0])console.log(t[0][f])}function b(n,t,i,r){var f,e,u,o;if("Reference"in n)f=resourcer[t.indexOf(n.Reference)],f?i.eventresourcer.push(f):alert("fejl5 ved indlæsning af resource for ");else if("Role"in n&&"ResourceType"in n)if(e=resourcetyper[r.indexOf(n.ResourceType.Reference)],e)for(u=0,o=i.duration;u<o;u++)i.eventresmangler.push(new p(n.Role,e,i,u,n.Workload));else alert("fejlx v res event");else alert("fejl v res event")}function k(n,t,i,r,u,f){var a=n.Name,v=n.Id,y=n.Weight,tt=n.Required=="true",p=n.CostFunction,it=n.Role,e,s,h,b,o,l,k;switch(t){case"AssignResourceConstraint":e=new w(v,a,y,p,it);break;case"AssignTimeConstraint":e=new c(v,a,y,p);break;case"PreferTimesConstraint":e=new g(v,a,y,p);break;case"SpreadEventsConstraint":e=new nt(v,a,y,p);break;case"PreferResourcesConstraint":e=new d(v,a,y,p)}if(e){if(n.AppliesTo.Events)if(o=n.AppliesTo,o.Events.Event instanceof Array)for(l in o.Events.Event)e.appliestogre.push(eventgrupper[r.indexOf(o.Events.Event[l].Reference)]);else e.appliestoev.push(events[r.indexOf(o.Events.Event.Reference)]);if(n.AppliesTo.EventGroups)if(o=n.AppliesTo,o.EventGroups.EventGroup instanceof Array)for(l in o.EventGroups.EventGroup)for(s=eventgrupper[i.indexOf(o.EventGroups.EventGroup[l].Reference)],e.appliestogre.push(s),h=0,b=s.events.length;h<b;h++)e.appliestoev.indexOf(s.events[h])==-1&&e.appliestoev.push(s.events[h]);else for(s=eventgrupper[i.indexOf(o.EventGroups.EventGroup.Reference)],e.appliestogre.push(s),h=0,b=s.events.length;h<b;h++)e.appliestoev.indexOf(s.events[h])==-1&&e.appliestoev.push(s.events[h]);if(n.Resource,n.ResourceGroups)if(o=n.ResourceGroups,o.ResourceGroup instanceof Array)for(l in o.ResourceGroup)k=resourcegrupper[f.indexOf(o.ResourceGroup[l].Reference)],e.appliestogrr.push(k);else k=resourcegrupper[f.indexOf(o.ResourceGroup.Reference)],e.appliestogrr.push(k);tt?hardconstraints.push(e):softconstraints.push(e)}}var w=function(){function n(n,t,i,u,f){this.id=n,this.name=t,this.weight=i,this.role=f,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),c,l,i,f,e,u,o,s,h,a,v,y,p;n.AssignResourceConstraint=w,c=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),n.AssignTimeConstraint=c;var d=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[],this.appliestogrr=[],this.appliestores=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),g=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),nt=function(){function n(n,t,i,u){this.id=n,this.name=t,this.weight=i,this.appliestogre=[],this.appliestoev=[];switch(u.toLowerCase()){case"sum":this.costfunction=r}}return n}(),t=function(){function n(n,t){this.id=n,this.name=t,(n===undefined||t===undefined)&&alert("Fejl ved indlæsning af "+n+","+t)}return n}();n.Entity=t,l=function(n){function t(t,i){n.call(this,i,t),this.timegroups=[],this.index=timer.length}return __extends(t,n),t}(t),n.Time=l,i=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(t),n.TimeGroup=i,f=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Week=f,e=function(n){function t(t,i){n.call(this,i,t),this.timer=[]}return __extends(t,n),t}(i),n.Day=e,u=function(n){function t(t,i){n.call(this,i,t),this.events=[]}return __extends(t,n),t}(t),n.EventGroup=u,o=function(n){function t(t,i){n.call(this,i,t)}return __extends(t,n),t}(u),n.Course=o,s=function(n){function t(t,i){n.call(this,i,t),this.resourcegroups=[]}return __extends(t,n),t}(t),n.ResourceType=s,h=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcer=[]}return __extends(t,n),t}(t),n.ResourceGroup=h,a=function(n){function t(t,i,r){n.call(this,i,t),this.resourcetype=r,this.resourcegroups=[],this.index=resourcer.length}return __extends(t,n),t}(t),n.Resource=a,v=function(){function n(n,t,i,r,u){this.id=n,this.name=t,this.duration=i,this.workload=r,this.preasigntime=u,this.eventeventgrupper=[],this.eventresourcegrupper=[],this.eventresourcer=[],this.eventresmangler=[],this.eventtidmangler=[],this.index=events.length}return n}(),n.AEvent=v,y=function(){function n(n,t){this.aevent=n,this.durationindex=t,(n===null||t===null)&&alert("fejl ved indlæsningh af tidmangel "),this.index=tidmangler.length,tidmangler.push(this)}return n}(),n.TidMangel=y,p=function(){function n(n,t,i,r,u){this.role=n,this.resourcetype=t,this.aevent=i,this.durationindex=r,this.workload=u,(n===null||t===null)&&alert("fejl ved indlæsningh af mangel "+n+","+t.name),this.index=resmangler.length,resmangler.push(this)}return n}(),n.ResMangel=p,n.readinstance=tt,n.readxml=it})(instans||(instans={}))